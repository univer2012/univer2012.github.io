
 <!DOCTYPE HTML>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
  
    <title>32关于AFNetworking3.0+的使用 | SengolnHuang&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="黄胜军">
    

    
    <meta name="description" content="来自：关于AFNetworking3.0+的使用 一、声明二、背景 AFNetworking 1.0建立在NSURLConnection的基础API之上 ， AFNetworking 2.0开始使用NSURLConnection的基础API ，以及较新基于NSURLSession的API的选项。 AFNetworking 3.0现已完全基于NSURLSession的API，这降低了维护的负担，同时">
<meta name="keywords">
<meta property="og:type" content="article">
<meta property="og:title" content="32关于AFNetworking3.0+的使用">
<meta property="og:url" content="https://univer2012.github.io/2017/12/05/32关于AFNetworking3-0-的使用/index.html">
<meta property="og:site_name" content="SengolnHuang's blog">
<meta property="og:description" content="来自：关于AFNetworking3.0+的使用 一、声明二、背景 AFNetworking 1.0建立在NSURLConnection的基础API之上 ， AFNetworking 2.0开始使用NSURLConnection的基础API ，以及较新基于NSURLSession的API的选项。 AFNetworking 3.0现已完全基于NSURLSession的API，这降低了维护的负担，同时">
<meta property="og:image" content="https://univer2012.github.io/2017/12/05/32关于AFNetworking3-0-的使用/NSURLSessionTask的继承关系.png">
<meta property="og:updated_time" content="2017-12-05T09:15:09.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="32关于AFNetworking3.0+的使用">
<meta name="twitter:description" content="来自：关于AFNetworking3.0+的使用 一、声明二、背景 AFNetworking 1.0建立在NSURLConnection的基础API之上 ， AFNetworking 2.0开始使用NSURLConnection的基础API ，以及较新基于NSURLSession的API的选项。 AFNetworking 3.0现已完全基于NSURLSession的API，这降低了维护的负担，同时">
<meta name="twitter:image" content="https://univer2012.github.io/2017/12/05/32关于AFNetworking3-0-的使用/NSURLSessionTask的继承关系.png">

    
    <link rel="alternative" href="/atom.xml" title="SengolnHuang&#39;s blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="SengolnHuang&#39;s blog" title="SengolnHuang&#39;s blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="SengolnHuang&#39;s blog">SengolnHuang&#39;s blog</a></h1>
				<h2 class="blog-motto">关注技术，分享生活</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:univer2012.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/12/05/32关于AFNetworking3-0-的使用/" title="32关于AFNetworking3.0+的使用" itemprop="url">32关于AFNetworking3.0+的使用</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="黄胜军" target="_blank" itemprop="author">黄胜军</a>
		
  <p class="article-time">
    <time datetime="2017-12-05T08:00:29.000Z" itemprop="datePublished"> Published 2017-12-05</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一、声明"><span class="toc-number">1.</span> <span class="toc-text">一、声明</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二、背景"><span class="toc-number">2.</span> <span class="toc-text">二、背景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三、NSURLConnection、NSURLSession的介绍"><span class="toc-number">3.</span> <span class="toc-text">三、NSURLConnection、NSURLSession的介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-NSURLConnection的介绍"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 NSURLConnection的介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-NSURLSession的介绍"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 NSURLSession的介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建NSURLSession对象的方法"><span class="toc-number">3.2.1.</span> <span class="toc-text">创建NSURLSession对象的方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSURLSessionTask支持的三种任务"><span class="toc-number">3.2.2.</span> <span class="toc-text">NSURLSessionTask支持的三种任务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#NSURLSessionTask类"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">NSURLSessionTask类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NSURLSessionTask相关方法"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">NSURLSessionTask相关方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NSURLSessionConfiguration配置信息"><span class="toc-number">3.2.2.3.</span> <span class="toc-text">NSURLSessionConfiguration配置信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-NSURLSessionDataTask简单GET请求"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.2.1 NSURLSessionDataTask简单GET请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-NSURLSessionDataTask简单POST请求"><span class="toc-number">3.2.4.</span> <span class="toc-text">3.2.2 NSURLSessionDataTask简单POST请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-3-NSURLSessionDataTask的NSURLSessionDataDelegate代理方法"><span class="toc-number">3.2.5.</span> <span class="toc-text">3.2.3 NSURLSessionDataTask的NSURLSessionDataDelegate代理方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-4、NSURLSessionDownloadTask简单下载"><span class="toc-number">3.2.6.</span> <span class="toc-text">3.2.4、NSURLSessionDownloadTask简单下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-5-NSURLSessionDownloadTask的NSURLSessionDownloadDelegate代理方法"><span class="toc-number">3.2.7.</span> <span class="toc-text">3.2.5 NSURLSessionDownloadTask的NSURLSessionDownloadDelegate代理方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-6、NSURLSessionDownloadTask断点下载"><span class="toc-number">3.2.8.</span> <span class="toc-text">3.2.6、NSURLSessionDownloadTask断点下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-7-NSURLSessionUploadTask"><span class="toc-number">3.2.9.</span> <span class="toc-text">3.2.7 NSURLSessionUploadTask</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#四、AFNetworking3-0-使用"><span class="toc-number">4.</span> <span class="toc-text">四、AFNetworking3.0+使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1、AFNetworking的导入"><span class="toc-number">4.1.</span> <span class="toc-text">4.1、AFNetworking的导入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2、简单GET请求"><span class="toc-number">4.2.</span> <span class="toc-text">4.2、简单GET请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3、简单POST请求"><span class="toc-number">4.3.</span> <span class="toc-text">4.3、简单POST请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4、下载"><span class="toc-number">4.4.</span> <span class="toc-text">4.4、下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5、上传"><span class="toc-number">4.5.</span> <span class="toc-text">4.5、上传</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-6、-网络监听"><span class="toc-number">4.6.</span> <span class="toc-text">4.6、 网络监听</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-7、-关于请求、返回格式设置"><span class="toc-number">4.7.</span> <span class="toc-text">4.7、 关于请求、返回格式设置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-1、请求格式（requestSerializer）"><span class="toc-number">4.7.1.</span> <span class="toc-text">4.7.1、请求格式（requestSerializer）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-2、-返回格式"><span class="toc-number">4.7.2.</span> <span class="toc-text">4.7.2、 返回格式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#例"><span class="toc-number">4.8.</span> <span class="toc-text">例</span></a></li></ol></li></ol>
		
		</div>
		
		<p>来自：<a href="http://www.jianshu.com/p/5e187c9d389b" target="_blank" rel="external">关于AFNetworking3.0+的使用</a></p>
<h1 id="一、声明"><a href="#一、声明" class="headerlink" title="一、声明"></a>一、声明</h1><h1 id="二、背景"><a href="#二、背景" class="headerlink" title="二、背景"></a>二、背景</h1><ul>
<li>AFNetworking 1.0建立在NSURLConnection的基础API之上 ，</li>
<li>AFNetworking 2.0开始使用NSURLConnection的基础API ，以及较新基于NSURLSession的API的选项。</li>
<li>AFNetworking 3.0现已完全基于NSURLSession的API，这降低了维护的负担，同时支持苹果增强关于NSURLSession提供的任何额外功能。</li>
</ul>
<p>由于Xcode 7中，<code>NSURLConnection</code>的API已经正式被苹果弃用。虽然该API将继续运行，但将没有新功能将被添加，并且苹果已经通知所有基于网络的功能，以充分使<code>NSURLSession</code>向前发展。</p>
<h1 id="三、NSURLConnection、NSURLSession的介绍"><a href="#三、NSURLConnection、NSURLSession的介绍" class="headerlink" title="三、NSURLConnection、NSURLSession的介绍"></a>三、NSURLConnection、NSURLSession的介绍</h1><h2 id="3-1-NSURLConnection的介绍"><a href="#3-1-NSURLConnection的介绍" class="headerlink" title="3.1 NSURLConnection的介绍"></a>3.1 NSURLConnection的介绍</h2><p>关于NSURLConnection的使用，本文不做详细的介绍，具体参考简书某位大神的介绍<a href="http://www.jianshu.com/p/f291ee58c012" target="_blank" rel="external">http://www.jianshu.com/p/f291ee58c012</a></p>
<h2 id="3-2-NSURLSession的介绍"><a href="#3-2-NSURLSession的介绍" class="headerlink" title="3.2 NSURLSession的介绍"></a>3.2 NSURLSession的介绍</h2><p>NSURLSession的优点：</p>
<ol>
<li><p>后台上传和下载。当你的程序退出了也能进行网络操作，这对用户和APP来说都是个好消息，不用运行APP就可以下载和上传，这样更节约手机电量。</p>
</li>
<li><p>能够暂停和恢复网络操作。不需要使用NSOperation就可以实现暂停、继续、重启等操作。</p>
</li>
<li><p>可配置的容器。</p>
</li>
<li><p>可以子类化并且可以设置私有存储方式。可以修改数据的存储方式和存储位置。</p>
</li>
<li><p>改进了授权处理机制。</p>
</li>
<li><p>代理更强大。</p>
</li>
<li><p>通过文件系统上传和下载。</p>
</li>
</ol>
<h3 id="创建NSURLSession对象的方法"><a href="#创建NSURLSession对象的方法" class="headerlink" title="创建NSURLSession对象的方法"></a>创建NSURLSession对象的方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">//1.使用静态的sharedSession方法，该类使用共享的会话，该会话使用全局的Cache，Cookie和证书。</div><div class="line">+ (NSURLSession * )sharedSession;  </div><div class="line">/*2.通过sessionWithConfiguration:方法创建对象，</div><div class="line">也就是创建对应配置的会话，与NSURLSessionConfiguration合作使用。</div><div class="line">*/</div><div class="line">(NSURLSession * )sessionWithConfiguration:(NSURLSessionConfiguration * )configuration;  </div><div class="line">/*3.通过sessionWithConfiguration:delegate:delegateQueue方法创建对象，</div><div class="line">二三两种方式可以创建一个新会话并定制其会话类型。</div><div class="line">该方式中指定了session的委托和委托所处的队列。</div><div class="line">当不再需要连接时，可以调用Session的invalidateAndCancel直接关闭，</div><div class="line">或者调用finishTasksAndInvalidate等待当前Task结束后关闭。</div><div class="line"></div><div class="line">这时Delegate会收到URLSession:didBecomeInvalidWithError:这个事件。Delegate收到这个事件之后会被解引用。</div><div class="line">*/</div><div class="line">+ (NSURLSession * )sessionWithConfiguration:(NSURLSessionConfiguration * )configuration delegate:(id &lt;NSURLSessionDelegate&gt;)delegate delegateQueue:(NSOperationQueue * )queue;</div></pre></td></tr></table></figure>
<h3 id="NSURLSessionTask支持的三种任务"><a href="#NSURLSessionTask支持的三种任务" class="headerlink" title="NSURLSessionTask支持的三种任务"></a>NSURLSessionTask支持的三种任务</h3><p>加载数据/下载/上传。</p>
<h4 id="NSURLSessionTask类"><a href="#NSURLSessionTask类" class="headerlink" title="NSURLSessionTask类"></a>NSURLSessionTask类</h4><p>NSURLSessionTask是一个抽象类，它有三个子类：</p>
<ol>
<li><code>NSURLSessionDataTask</code></li>
<li><code>NSURLSessionUploadTask</code></li>
<li><code>NSURLSessionDownloadTask</code></li>
</ol>
<p><strong>这三个类封装了应用程序的三个基本网络任务：获取数据，比如JSON或XML，以及上传和下载文件</strong>。<br>继承关系如下：</p>
<p><img src="/2017/12/05/32关于AFNetworking3-0-的使用/NSURLSessionTask的继承关系.png" alt="NSURLSessionTask的继承关系"></p>
<h4 id="NSURLSessionTask相关方法"><a href="#NSURLSessionTask相关方法" class="headerlink" title="NSURLSessionTask相关方法"></a>NSURLSessionTask相关方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//suspend可以让当前的任务暂停</div><div class="line">- (void)suspend;</div><div class="line">//resume方法不仅可以启动任务,还可以唤醒suspend状态的任务</div><div class="line">- (void)resume;</div><div class="line">//cancel方法可以取消当前的任务,你也可以向处于suspend状态的任务发送cancel消息,任务如果被取消便不能再恢复到之前的状态.</div><div class="line">- (void)cancel;</div></pre></td></tr></table></figure>
<h4 id="NSURLSessionConfiguration配置信息"><a href="#NSURLSessionConfiguration配置信息" class="headerlink" title="NSURLSessionConfiguration配置信息"></a>NSURLSessionConfiguration配置信息</h4><p>NSURLSessionConfiguration用于配置会话的属性，可以通过该类配置会话的工作模式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">NSURLSessionConfiguration *config = [NSURLSessionConfiguration defaultSessionConfiguration];</div><div class="line">// 超时时间</div><div class="line">config.timeoutIntervalForRequest = 10;</div><div class="line">// 是否允许使用蜂窝网络(后台传输不适用)</div><div class="line">config.allowsCellularAccess = YES;</div><div class="line">// 还有很多可以设置的属性</div><div class="line">//关于配置信息的实例化方法大概有三种</div><div class="line">/*</div><div class="line">//默认会话模式（default）：工作模式类似于原来的NSURLConnection，使用的是基于磁盘缓存的持久化策略，使用用户keychain中保存的证书进行认证授权。</div><div class="line">+ (NSURLSessionConfiguration *)defaultSessionConfiguration;</div><div class="line">//瞬时会话模式（ephemeral）：该模式不使用磁盘保存任何数据。所有和会话相关的caches，证书，cookies等都被保存在RAM中，因此当程序使会话无效，这些缓存的数据就会被自动清空。</div><div class="line">+ (NSURLSessionConfiguration *)ephemeralSessionConfiguration;</div><div class="line">//后台会话模式（background）：该模式在后台完成上传和下载，在创建Configuration对象的时候需要提供一个NSString类型的ID用于标识完成工作的后台会话。</div><div class="line">+ (NSURLSessionConfiguration *)backgroundSessionConfigurationWithIdentifier:(NSString *)identifier</div><div class="line">*/</div></pre></td></tr></table></figure></p>
<h3 id="3-2-1-NSURLSessionDataTask简单GET请求"><a href="#3-2-1-NSURLSessionDataTask简单GET请求" class="headerlink" title="3.2.1 NSURLSessionDataTask简单GET请求"></a>3.2.1 NSURLSessionDataTask简单GET请求</h3><p>如果请求的数据比较简单,也不需要对返回的数据做一些复杂的操作.那么我们可以使用带block：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">// 快捷方式获得session对象</div><div class="line">    NSURLSession *session = [NSURLSession sharedSession];</div><div class="line">    /*GET请求将参数拼接在 url 后面</div><div class="line">     网络接口 和 参数 以 ? 分隔. 参数和参数之间以 &amp; 符号分隔.注意删除最后一个 &amp; 符号.</div><div class="line">     如：http://127.0.0.1/login.php?username=zhangsan&amp;password=zhang</div><div class="line">     */</div><div class="line">    NSURL *url = [NSURL URLWithString:@&quot;http://www.daka.com/login?username=daka&amp;pwd=123&quot;];</div><div class="line">    // GET请求直接根据url实例化网络任务</div><div class="line">    /*</div><div class="line">     第一个参数：请求路径:内部会自动将路径包装成请求对象</div><div class="line">     第二个参数：completionHandler回调（请求完成【成功|失败】的回调）</div><div class="line">     data：响应体信息（期望的数据）</div><div class="line">     response：响应头信息，主要是对服务器端的描述</div><div class="line">     error：错误信息，如果请求失败，则error有值</div><div class="line">     */</div><div class="line">    NSURLSessionTask *task = [session dataTaskWithURL:url completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) &#123;</div><div class="line">        // 默认是子线程.</div><div class="line">        NSLog(@&quot;%@&quot;,[[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding]);</div><div class="line">    &#125;];</div><div class="line">    // 开启任务</div><div class="line">    [task resume];</div></pre></td></tr></table></figure></p>
<h3 id="3-2-2-NSURLSessionDataTask简单POST请求"><a href="#3-2-2-NSURLSessionDataTask简单POST请求" class="headerlink" title="3.2.2 NSURLSessionDataTask简单POST请求"></a>3.2.2 NSURLSessionDataTask简单POST请求</h3><p>&nbsp; &nbsp; &nbsp; &nbsp;POST和GET的区别就在于request,所以使用session的POST请求和GET过程是一样的,区别就在于对request的处理。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">NSURL *url = [NSURL URLWithString:@&quot;http://www.daka.com/login&quot;];</div><div class="line">    //创建可变请求对象</div><div class="line">    NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url];</div><div class="line">    //POST请求将参数添加在请求体中</div><div class="line">    //设置请求方法</div><div class="line">    request.HTTPMethod = @&quot;POST&quot;;</div><div class="line">    //设置请求体</div><div class="line">    request.HTTPBody = [@&quot;username=daka&amp;pwd=123&quot; dataUsingEncoding:NSUTF8StringEncoding];</div><div class="line"></div><div class="line">    NSURLSession *session = [NSURLSession sharedSession];</div><div class="line">    /*</div><div class="line">     第一个参数：请求对象</div><div class="line">     第二个参数：completionHandler回调（请求完成【成功|失败】的回调）</div><div class="line">     data：响应体信息（期望的数据）</div><div class="line">     response：响应头信息，主要是对服务器端的描述</div><div class="line">     error：错误信息，如果请求失败，则error有值</div><div class="line">     */</div><div class="line">    // 由于要先对request先行处理,我们通过request初始化task</div><div class="line">    NSURLSessionTask *task = [session dataTaskWithRequest:request</div><div class="line">                                        completionHandler:^(NSData *data, NSURLResponse *response, NSError *error)</div><div class="line">    &#123;</div><div class="line">        // 默认是子线程.</div><div class="line">        NSLog(@&quot;%@&quot;,[[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding]);</div><div class="line">    &#125;];</div><div class="line">    [task resume];</div></pre></td></tr></table></figure></p>
<h3 id="3-2-3-NSURLSessionDataTask的NSURLSessionDataDelegate代理方法"><a href="#3-2-3-NSURLSessionDataTask的NSURLSessionDataDelegate代理方法" class="headerlink" title="3.2.3 NSURLSessionDataTask的NSURLSessionDataDelegate代理方法"></a>3.2.3 <code>NSURLSessionDataTask</code>的<code>NSURLSessionDataDelegate</code>代理方法</h3><p>&nbsp; &nbsp; &nbsp; &nbsp;<code>NSURLSession</code>提供了block方式处理返回数据的简便方式,但如果想要在接收数据过程中做进一步的处理,仍然可以调用相关的协议方法。<code>NSURLSession</code>的代理方法和<code>NSURLConnection</code>有些类似,都是分为接收响应、接收数据、请求完成几个阶段。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">@interface SGHAFNetworkingViewController ()&lt;NSURLSessionDelegate&gt;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation SGHAFNetworkingViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    // Do any additional setup after loading the view.</div><div class="line"></div><div class="line">    // 使用代理方法需要设置代理,但是session的delegate属性是只读的,要想设置代理只能通过这种方式创建session</div><div class="line">    NSURLSession *session = [NSURLSession sessionWithConfiguration:[NSURLSessionConfiguration defaultSessionConfiguration] delegate:self delegateQueue:[[NSOperationQueue alloc] init]];</div><div class="line">    // 创建任务(因为要使用代理方法,就不需要block方式的初始化了)</div><div class="line">    NSURLSessionDataTask *task = [session dataTaskWithRequest:[NSURLRequest requestWithURL:[NSURL URLWithString:@&quot;http://www.daka.com/login?userName=daka&amp;pwd=123&quot;]]];</div><div class="line">    // 启动任务</div><div class="line">    [task resume];</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">//对应的代理方法如下:</div><div class="line">// 1.接收到服务器的响应</div><div class="line">- (void)URLSession:(NSURLSession *)session dataTask:(NSURLSessionDataTask *)dataTask didReceiveResponse:(NSURLResponse *)response completionHandler:(void (^)(NSURLSessionResponseDisposition))completionHandler &#123;</div><div class="line">    // 允许处理服务器的响应，才会继续接收服务器返回的数据</div><div class="line">    completionHandler(NSURLSessionResponseAllow);</div><div class="line">&#125;</div><div class="line">// 2.接收到服务器的数据（可能调用多次）</div><div class="line">- (void)URLSession:(NSURLSession *)session dataTask:(NSURLSessionDataTask *)dataTask didReceiveData:(NSData *)data &#123;</div><div class="line">    // 处理每次接收的数据</div><div class="line">&#125;</div><div class="line">// 3.请求成功或者失败（如果失败，error有值）</div><div class="line">- (void)URLSession:(NSURLSession *)session task:(NSURLSessionTask *)task didCompleteWithError:(NSError *)error</div><div class="line">&#123;</div><div class="line">    // 请求完成,成功或者失败的处理</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<blockquote>
<p>提示：<br>关键点在代码注释里面都有提及,重要的地方再强调一下:</p>
<p>如果要使用代理方法,需要设置代理,但从NSURLSession的头文件发现session的delegate属性是只读的。因此设置代理要通过session的初始化方法赋值:<code>sessionWithConfiguration:delegate:delegateQueue:</code></p>
<p>其中:<br>configuration参数：(文章开始提到的)需要传递一个配置,我们暂且使用默认的配置<code>[NSURLSessionConfiguration defaultSessionConfiguration]</code>就好(后面会说下这个配置是干嘛用的);</p>
<p>delegateQueue参数：表示协议方法将会在哪个队列(NSOperationQueue)里面执行。</p>
<p>NSURLSession在接收到响应的时候要先对响应做允许处理:<code>completionHandler(NSURLSessionResponseAllow);</code>，才会继续接收服务器返回的数据,进入后面的代理方法。</p>
<p>值得一提的是，如果在接收响应的时候需要对返回的参数进行处理(如获取响应头信息等)，那么这些处理应该放在前面允许操作的前面。</p>
</blockquote>
<h3 id="3-2-4、NSURLSessionDownloadTask简单下载"><a href="#3-2-4、NSURLSessionDownloadTask简单下载" class="headerlink" title="3.2.4、NSURLSessionDownloadTask简单下载"></a>3.2.4、NSURLSessionDownloadTask简单下载</h3><p><code>NSURLSessionDownloadTask</code>同样提供了通过NSURL和<code>NSURLRequest</code>两种方式来初始化并通过block进行回调的方法.下面以<code>NSURL</code>初始化为例:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">NSURLSession *session = [NSURLSession sharedSession];</div><div class="line">    NSURL *url = [NSURL URLWithString:@&quot;http://www.daka.com/resources/image/icon.png&quot;] ;</div><div class="line">    NSURLSessionDownloadTask *task = [session downloadTaskWithURL:url completionHandler:^(NSURL *location, NSURLResponse *response, NSError *error) &#123;</div><div class="line">        // location是沙盒中tmp文件夹下的一个临时url,文件下载后会存到这个位置,由于tmp中的文件随时可能被删除,所以我们需要自己需要把下载的文件挪到需要的地方</div><div class="line">        NSString *path = [[NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES) lastObject] stringByAppendingPathComponent:response.suggestedFilename];</div><div class="line">        [[NSFileManager defaultManager] moveItemAtURL:location toURL:[NSURL fileURLWithPath:path] error:nil];</div><div class="line">    &#125;];</div><div class="line">    // 启动任务</div><div class="line">    [task resume];</div></pre></td></tr></table></figure></p>
<blockquote>
<p>Tips:<br>需要注意的就是需要将下载到tmp文件夹的文件转移到需要的目录.原因在代码中已经贴出。</p>
<p><code>response.suggestedFilename</code>是从响应中取出文件在服务器上存储路径的最后部分,如数据在服务器的url为<a href="http://www.daka.com/resources/image/icon.png" target="_blank" rel="external">http://www.daka.com/resources/image/icon.png</a>, 那么其suggestedFilename就是icon.png。</p>
</blockquote>
<h3 id="3-2-5-NSURLSessionDownloadTask的NSURLSessionDownloadDelegate代理方法"><a href="#3-2-5-NSURLSessionDownloadTask的NSURLSessionDownloadDelegate代理方法" class="headerlink" title="3.2.5 NSURLSessionDownloadTask的NSURLSessionDownloadDelegate代理方法"></a>3.2.5 <code>NSURLSessionDownloadTask</code>的<code>NSURLSessionDownloadDelegate</code>代理方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">// 每次写入调用(会调用多次)</div><div class="line">- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didWriteData:(int64_t)bytesWritten totalBytesWritten:(int64_t)totalBytesWritten totalBytesExpectedToWrite:(int64_t)totalBytesExpectedToWrite</div><div class="line">&#123;</div><div class="line">      // 可在这里通过已写入的长度和总长度算出下载进度</div><div class="line">      CGFloat progress = 1.0 * totalBytesWritten / totalBytesExpectedToWrite; NSLog(@&quot;%f&quot;,progress);</div><div class="line">&#125;</div><div class="line">// 下载完成调用</div><div class="line">- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didFinishDownloadingToURL:(NSURL *)location</div><div class="line">&#123;</div><div class="line">      // location还是一个临时路径,需要自己挪到需要的路径(caches下面) NSString *filePath = [[NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES) lastObject] stringByAppendingPathComponent:downloadTask.response.suggestedFilename]; [[NSFileManager defaultManager] moveItemAtURL:location toURL:[NSURL fileURLWithPath:filePath] error:nil];</div><div class="line">&#125;</div><div class="line">// 任务完成调用</div><div class="line">- (void)URLSession:(NSURLSession *)session task:(NSURLSessionTask *)task didCompleteWithError:(NSError *)error</div><div class="line">&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-2-6、NSURLSessionDownloadTask断点下载"><a href="#3-2-6、NSURLSessionDownloadTask断点下载" class="headerlink" title="3.2.6、NSURLSessionDownloadTask断点下载"></a>3.2.6、NSURLSessionDownloadTask断点下载</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">// 使用这种方式取消下载可以得到将来用来恢复的数据,保存起来</div><div class="line">[self.task cancelByProducingResumeData:^(NSData *resumeData) &#123;</div><div class="line">    self.resumeData = resumeData;</div><div class="line">&#125;];</div><div class="line">// 由于下载失败导致的下载中断会进入此协议方法,也可以得到用来恢复的数据</div><div class="line">- (void)URLSession:(NSURLSession *)session task:(NSURLSessionTask *)task didCompleteWithError:(NSError *)error</div><div class="line">&#123;</div><div class="line">    // 保存恢复数据</div><div class="line">    self.resumeData = error.userInfo[NSURLSessionDownloadTaskResumeData];</div><div class="line">&#125;</div><div class="line">// 恢复下载时接过保存的恢复数据</div><div class="line">self.task = [self.session downloadTaskWithResumeData:self.resumeData];</div><div class="line">// 启动任务</div><div class="line">[self.task resume];</div></pre></td></tr></table></figure>
<p>//程序强制退出就无法断点下载了，具体方法见<a href="http://blog.csdn.net/qianlima210210/article/details/49303703" target="_blank" rel="external">http://blog.csdn.net/qianlima210210/article/details/49303703</a></p>
<h3 id="3-2-7-NSURLSessionUploadTask"><a href="#3-2-7-NSURLSessionUploadTask" class="headerlink" title="3.2.7 NSURLSessionUploadTask"></a>3.2.7 NSURLSessionUploadTask</h3><p>在NSURLSession中，文件上传方式主要有以下两种：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">//第一种方式</div><div class="line">    NSURLSessionUploadTask *task =</div><div class="line">    [[NSURLSession sharedSession] uploadTaskWithRequest:request fromFile:fileName</div><div class="line">                                      completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) &#123;</div><div class="line">    &#125;];</div><div class="line">    //第二种方式</div><div class="line">    [self.session uploadTaskWithRequest:request fromData:body</div><div class="line">                      completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) &#123;</div><div class="line">            NSLog(@&quot;-------%@&quot;, [NSJSONSerialization JSONObjectWithData:data options:kNilOptions error:nil]);</div><div class="line">    &#125;];</div><div class="line">    /*</div><div class="line">     处于安全性考虑,通常我们会使用POST方式进行文件上传,所以较多使用第二种方式。</div><div class="line"></div><div class="line">     但是,NSURLSession并没有为我们提供比NSURLConnection更方便的文件上传方式。方法中body处的参数需要填写request的请求体(http协议规定格式的大长串).</div><div class="line">     */</div></pre></td></tr></table></figure></p>
<p>关于NSURLSessionConfiguration的使用可以参考<a href="http://www.jianshu.com/p/fafc67475c73" target="_blank" rel="external">http://www.jianshu.com/p/fafc67475c73</a><br>以及<a href="http://www.tuicool.com/articles/VBv2qe" target="_blank" rel="external">http://www.tuicool.com/articles/VBv2qe</a></p>
<h1 id="四、AFNetworking3-0-使用"><a href="#四、AFNetworking3-0-使用" class="headerlink" title="四、AFNetworking3.0+使用"></a>四、AFNetworking3.0+使用</h1><p>由于苹果已经弃用<code>NSURLConnection</code>，所以在此暂时只介绍AFNetworking3.0及3.0+以上的使用方法。</p>
<h2 id="4-1、AFNetworking的导入"><a href="#4-1、AFNetworking的导入" class="headerlink" title="4.1、AFNetworking的导入"></a>4.1、AFNetworking的导入</h2><p>本人习惯使用cocoaPods 进行管理第三方类库，导入过程不做详细介绍，不会的可以上网查看教程</p>
<h2 id="4-2、简单GET请求"><a href="#4-2、简单GET请求" class="headerlink" title="4.2、简单GET请求"></a>4.2、简单GET请求</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];</div><div class="line">[manager GET:URL parameters:nil progress:^(NSProgress * _Nonnull downloadProgress) &#123;</div><div class="line"></div><div class="line"> &#125; success:^(NSURLSessionDataTask * _Nonnull task, id _Nullable responseObject) &#123;</div><div class="line">             NSLog(@&quot;这里打印请求成功要做的事&quot;);</div><div class="line"> &#125;failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) &#123;</div><div class="line">             NSLog(@&quot;%@&quot;,error); //这里打印错误信息</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<h2 id="4-3、简单POST请求"><a href="#4-3、简单POST请求" class="headerlink" title="4.3、简单POST请求"></a>4.3、简单POST请求</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];</div><div class="line">NSMutableDictionary *parameters = @&#123;@&quot;&quot;:@&quot;&quot;,@&quot;&quot;:@&quot;&quot;&#125;;</div><div class="line">[manager POST:URL parameters:parameters progress:^(NSProgress * _Nonnull uploadProgress) &#123;</div><div class="line"></div><div class="line">&#125; success:^(NSURLSessionDataTask * _Nonnull task, id _Nullable responseObject) &#123;</div><div class="line"></div><div class="line">&#125; failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) &#123;</div><div class="line"></div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<h2 id="4-4、下载"><a href="#4-4、下载" class="headerlink" title="4.4、下载"></a>4.4、下载</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">- (void)downLoad&#123;</div><div class="line">    //1.创建管理者对象</div><div class="line">    AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];</div><div class="line">    //2.确定请求的URL地址</div><div class="line">    NSURL *url = [NSURL URLWithString:@&quot;&quot;];</div><div class="line">    //3.创建请求对象</div><div class="line">    NSURLRequest *request = [NSURLRequest requestWithURL:url];</div><div class="line">    //4.下载任务</div><div class="line">    NSURLSessionDownloadTask *task = [manager downloadTaskWithRequest:request progress:^(NSProgress * _Nonnull downloadProgress) &#123;</div><div class="line">        //打印下下载进度</div><div class="line">        NSLog(@&quot;%lf&quot;,1.0 * downloadProgress.completedUnitCount / downloadProgress.totalUnitCount);</div><div class="line">    &#125; destination:^NSURL * _Nonnull(NSURL * _Nonnull targetPath, NSURLResponse * _Nonnull response) &#123;</div><div class="line">        //下载地址</div><div class="line">        NSLog(@&quot;默认下载地址:%@&quot;,targetPath);</div><div class="line">        //设置下载路径，通过沙盒获取缓存地址，最后返回NSURL对象</div><div class="line">        NSString *filePath = [NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES)lastObject];</div><div class="line">        return [NSURL URLWithString:filePath];</div><div class="line">    &#125; completionHandler:^(NSURLResponse * _Nonnull response, NSURL * _Nullable filePath, NSError * _Nullable error) &#123;</div><div class="line">        //下载完成调用的方法 WKNSLog(@&quot;下载完成：&quot;);</div><div class="line">        NSLog(@&quot;%@--%@&quot;,response,filePath);</div><div class="line">    &#125;];</div><div class="line">    //开始启动任务</div><div class="line">    [task resume];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="4-5、上传"><a href="#4-5、上传" class="headerlink" title="4.5、上传"></a>4.5、上传</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">//第一种方法是通过工程中的文件进行上传</div><div class="line">- (void)upLoad1&#123;</div><div class="line"></div><div class="line">    //1。创建管理者对象</div><div class="line">    AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];</div><div class="line"></div><div class="line">    //2.上传文件</div><div class="line">    NSDictionary *dict = @&#123;@&quot;username&quot;:@&quot;1234&quot;&#125;;</div><div class="line"></div><div class="line">    NSString *urlString = @&quot;22222&quot;;</div><div class="line">    [manager POST:urlString parameters:dict constructingBodyWithBlock:^(id&lt;AFMultipartFormData&gt;  _Nonnull formData) &#123;</div><div class="line">        //上传文件参数</div><div class="line">        UIImage *iamge = [UIImage imageNamed:@&quot;123.png&quot;];</div><div class="line">        NSData *data = UIImagePNGRepresentation(iamge);</div><div class="line">        //这个就是参数</div><div class="line">        [formData appendPartWithFileData:data name:@&quot;file&quot; fileName:@&quot;123.png&quot; mimeType:@&quot;image/png&quot;];</div><div class="line"></div><div class="line">    &#125; progress:^(NSProgress * _Nonnull uploadProgress) &#123;</div><div class="line"></div><div class="line">        //打印下上传进度</div><div class="line">        NSLog(@&quot;%lf&quot;,1.0 *uploadProgress.completedUnitCount / uploadProgress.totalUnitCount);</div><div class="line">    &#125; success:^(NSURLSessionDataTask * _Nonnull task, id  _Nullable responseObject) &#123;</div><div class="line"></div><div class="line">        //请求成功</div><div class="line">        NSLog(@&quot;请求成功：%@&quot;,responseObject);</div><div class="line"></div><div class="line">    &#125; failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) &#123;</div><div class="line">        //请求失败</div><div class="line">        NSLog(@&quot;请求失败：%@&quot;,error);</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">//第二种是通过URL来获取路径，进入沙盒或者系统相册等等</div><div class="line">- (void)upLoda2&#123;</div><div class="line">    //1.创建管理者对象</div><div class="line">    AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];</div><div class="line">    //2.上传文件</div><div class="line">    NSDictionary *dict = @&#123;@&quot;username&quot;:@&quot;1234&quot;&#125;;</div><div class="line"></div><div class="line">    NSString *urlString = @&quot;22222&quot;;</div><div class="line">    [manager POST:urlString parameters:dict constructingBodyWithBlock:^(id&lt;AFMultipartFormData&gt;  _Nonnull formData) &#123;</div><div class="line"></div><div class="line">        [formData appendPartWithFileURL:[NSURL fileURLWithPath:@&quot;文件地址&quot;] name:@&quot;file&quot; fileName:@&quot;1234.png&quot; mimeType:@&quot;application/octet-stream&quot; error:nil];</div><div class="line">    &#125; progress:^(NSProgress * _Nonnull uploadProgress) &#123;</div><div class="line"></div><div class="line">        //打印下上传进度</div><div class="line">        NSLog(@&quot;%lf&quot;,1.0 *uploadProgress.completedUnitCount / uploadProgress.totalUnitCount);</div><div class="line">    &#125; success:^(NSURLSessionDataTask * _Nonnull task, id  _Nullable responseObject) &#123;</div><div class="line"></div><div class="line">        //请求成功</div><div class="line">        NSLog(@&quot;请求成功：%@&quot;,responseObject);</div><div class="line"></div><div class="line">    &#125; failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) &#123;</div><div class="line"></div><div class="line">        //请求失败</div><div class="line">        NSLog(@&quot;请求失败：%@&quot;,error);</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="4-6、-网络监听"><a href="#4-6、-网络监听" class="headerlink" title="4.6、 网络监听"></a>4.6、 网络监听</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">- (void)AFNetworkStatus&#123;</div><div class="line">    //1.创建网络监测者</div><div class="line">    AFNetworkReachabilityManager *manager = [AFNetworkReachabilityManager sharedManager];</div><div class="line">    /*枚举里面四个状态 分别对应 未知 无网络 数据 WiFi</div><div class="line">     typedef NS_ENUM(NSInteger, AFNetworkReachabilityStatus) &#123;</div><div class="line">     AFNetworkReachabilityStatusUnknown = -1, 未知</div><div class="line">     AFNetworkReachabilityStatusNotReachable = 0, 无网络</div><div class="line">     AFNetworkReachabilityStatusReachableViaWWAN = 1, 蜂窝数据网络</div><div class="line">     AFNetworkReachabilityStatusReachableViaWiFi = 2, WiFi</div><div class="line">     &#125;;   */</div><div class="line">    [manager setReachabilityStatusChangeBlock:^(AFNetworkReachabilityStatus status) &#123;</div><div class="line">        //这里是监测到网络改变的block 可以写成switch方便</div><div class="line">        //在里面可以随便写事件</div><div class="line">        switch (status)</div><div class="line">        &#123;</div><div class="line">            case AFNetworkReachabilityStatusUnknown:</div><div class="line">                NSLog(@&quot;未知网络状态&quot;);</div><div class="line">                break;</div><div class="line">            case AFNetworkReachabilityStatusNotReachable:</div><div class="line">                NSLog(@&quot;无网络&quot;);</div><div class="line">                break;</div><div class="line">            case AFNetworkReachabilityStatusReachableViaWWAN:</div><div class="line">                NSLog(@&quot;蜂窝数据网&quot;);</div><div class="line">                break;</div><div class="line">            case AFNetworkReachabilityStatusReachableViaWiFi:</div><div class="line">                NSLog(@&quot;WiFi网络&quot;);</div><div class="line">                break;</div><div class="line">            default:</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line">    &#125;] ;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="4-7、-关于请求、返回格式设置"><a href="#4-7、-关于请求、返回格式设置" class="headerlink" title="4.7、 关于请求、返回格式设置"></a>4.7、 关于请求、返回格式设置</h2><p>所有的网络请求,均有manager发起</p>
<h3 id="4-7-1、请求格式（requestSerializer）"><a href="#4-7-1、请求格式（requestSerializer）" class="headerlink" title="4.7.1、请求格式（requestSerializer）"></a>4.7.1、请求格式（requestSerializer）</h3><p>需要注意的是,默认提交请求的数据是二进制的,返回格式是JSON<br>如果提交数据是JSON的,需要将请求格式设置为<code>AFJSONRequestSerializer</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//AFHTTPRequestSerializer            二进制格式(默认请求格式)</div><div class="line">     manager.requestSerializer = [AFHTTPRequestSerializer serializer];</div><div class="line"> //AFJSONRequestSerializer         JSON</div><div class="line">     manager.requestSerializer = [AFJSONRequestSerializer serializer];</div><div class="line">  //AFPropertyListRequestSerializer    PList(是一种特殊的XML,解析起来相对容易)</div><div class="line">     manager.requestSerializer = [AFPropertyListRequestSerializer serializer];</div></pre></td></tr></table></figure></p>
<h3 id="4-7-2、-返回格式"><a href="#4-7-2、-返回格式" class="headerlink" title="4.7.2、 返回格式"></a>4.7.2、 返回格式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">//AFHTTPResponseSerializer          二进制格式</div><div class="line">     manager.responseSerializer = [AFHTTPResponseSerializer serializer];</div><div class="line">   //AFJSONResponseSerializer          JSON（默认情况下返回json,所以有时后返回的不是json，就要重新设置返回格式）</div><div class="line">     manager.responseSerializer = [AFJSONResponseSerializer serializer];</div><div class="line">   //AFXMLParserResponseSerializer     XML,只能返回XMLParser,还需要自己通过代理方法解析（下面将介绍用NSXMLParser解析xml）</div><div class="line">     manager.responseSerializer = [AFXMLParserResponseSerializer serializer];</div><div class="line">   //AFXMLDocumentResponseSerializer (Mac OS X)</div><div class="line">   //AFPropertyListResponseSerializer   PList</div><div class="line">   //AFImageResponseSerializer        Image</div><div class="line">   //AFCompoundResponseSerializer      组合</div><div class="line"></div><div class="line">   //通过acceptableContentTypes可以添加接收的类型，如果没有设置，出错情况下会提示,</div><div class="line">   //具体参考http://www.jianshu.com/p/212a128c9a33，</div><div class="line">   //可以在`AFURLResponseSerialization.m`源代码中添加接收的类型</div><div class="line">   /*</div><div class="line">   - (instancetype)init &#123;</div><div class="line">        self = [super init];</div><div class="line">        if (!self) &#123;</div><div class="line">        return nil;</div><div class="line">    &#125;</div><div class="line">        self.acceptableContentTypes = [NSSet setWithObjects:@&quot;application/json&quot;, @&quot;text/json&quot;, @&quot;text/javascript&quot;, nil];</div><div class="line">        return self;</div><div class="line">   &#125;</div><div class="line">  */</div><div class="line">   manager.responseSerializer.acceptableContentTypes = [NSSet setWithObject:@&quot;application/xml&quot;];</div></pre></td></tr></table></figure>
<p>关于该部分的理解，可以参考<a href="http://www.jianshu.com/p/3aa19c12000a" target="_blank" rel="external">http://www.jianshu.com/p/3aa19c12000a</a></p>
<h2 id="例"><a href="#例" class="headerlink" title="例"></a>例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">//请求解析</div><div class="line">AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];</div><div class="line">    manager.responseSerializer = [AFXMLParserResponseSerializer serializer];</div><div class="line">    manager.responseSerializer.acceptableContentTypes = [NSSet setWithObject:@&quot;application/xml&quot;];</div><div class="line">    manager.requestSerializer = [AFJSONRequestSerializer serializer];</div><div class="line">   //afn默认发起的是异步请求</div><div class="line">   [manager GET:@&quot;http://localhost/sources/videos.xml&quot; parameters:nil progress:nil success:^(NSURLSessionDataTask * _Nonnull task, id  _Nullable responseObject) &#123;</div><div class="line">        NSLog(@&quot;%@&quot;,[NSThread currentThread]);//打印结果是主线程，也就是说，异步请求之后，自动返回主线程</div><div class="line">//        NSLog(@&quot;%@&quot;,responseObject);</div><div class="line">        if ([responseObject isKindOfClass:[NSXMLParser class]]) &#123;</div><div class="line">            NSXMLParser *parser = responseObject;</div><div class="line">            parser.delegate = self;</div><div class="line">            dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</div><div class="line">                [parser parse];</div><div class="line">            &#125;);</div><div class="line">        ｝</div><div class="line"></div><div class="line">    &#125; failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) &#123;</div><div class="line">        NSLog(@&quot;%@&quot;,error.localizedDescription);</div><div class="line">    &#125;];</div><div class="line"></div><div class="line"></div><div class="line">//MARK: 代理部分</div><div class="line">-(void)parserDidStartDocument:(NSXMLParser *)parser&#123;</div><div class="line">    NSLog(@&quot;打开文档，准备开始解析&quot;);</div><div class="line">&#125;</div><div class="line">-(void)parser:(NSXMLParser *)parser didStartElement:(NSString *)elementName namespaceURI:(NSString *)namespaceURI qualifiedName:(NSString *)qName attributes:(NSDictionary&lt;NSString *,NSString *&gt; *)attributeDict&#123;</div><div class="line">    NSLog(@&quot;startElement=%@ attributeDict=%@&quot;,elementName,attributeDict);</div><div class="line">    if ([elementName isEqualToString:@&quot;video&quot;]) &#123;</div><div class="line">        self.currentVideo = [[XFSVideo alloc]init];</div><div class="line">        self.currentVideo.videoId = attributeDict[@&quot;videoId&quot;];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">-(void)parser:(NSXMLParser *)parser foundCharacters:(NSString *)string&#123;</div><div class="line">    NSLog(@&quot;foundCharacters=%@&quot;,string);</div><div class="line">    [self.elementString appendString:string];</div><div class="line">&#125;</div><div class="line">-(void)parser:(NSXMLParser *)parser didEndElement:(NSString *)elementName namespaceURI:(NSString *)namespaceURI qualifiedName:(NSString *)qName&#123;</div><div class="line">    NSLog(@&quot;endelement=%@&quot;,elementName);</div><div class="line">    NSLog(@&quot;%@&quot;,[NSThread currentThread]);</div><div class="line">    if ([elementName isEqualToString:@&quot;video&quot;]) &#123;</div><div class="line">        [self.videos addObject:self.currentVideo];</div><div class="line">        self.currentVideo = nil;</div><div class="line">    &#125;else if (![elementName isEqualToString:@&quot;videos&quot;])&#123;</div><div class="line">        [self.currentVideo setValue:self.elementString forKeyPath:elementName];</div><div class="line">        self.elementString = nil;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">-(void)parserDidEndDocument:(NSXMLParser *)parser&#123;</div><div class="line">    NSLog(@&quot;%@&quot;,self.videos);</div><div class="line">    NSLog(@&quot;结束文档&quot;);</div><div class="line">    dispatch_async(dispatch_get_main_queue(), ^&#123;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


</div>



	<div class="article-share" id="share">
	
	  <div data-url="https://univer2012.github.io/2017/12/05/32关于AFNetworking3-0-的使用/" data-title="32关于AFNetworking3.0+的使用 | SengolnHuang&#39;s blog" data-tsina="2669931682" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2017/12/05/30AFNetworking-3-0迁移指南/" title="30AFNetworking 3.0迁移指南">
  <strong>上一篇：</strong><br/>
  <span>
  30AFNetworking 3.0迁移指南</span>
</a>
</div>


<div class="next">
<a href="/2017/12/05/33FMDB的使用方法/"  title="33FMDB的使用方法">
 <strong>下一篇：</strong><br/> 
 <span>33FMDB的使用方法
</span>
</a>
</div>

</nav>

	

<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一、声明"><span class="toc-number">1.</span> <span class="toc-text">一、声明</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二、背景"><span class="toc-number">2.</span> <span class="toc-text">二、背景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三、NSURLConnection、NSURLSession的介绍"><span class="toc-number">3.</span> <span class="toc-text">三、NSURLConnection、NSURLSession的介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-NSURLConnection的介绍"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 NSURLConnection的介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-NSURLSession的介绍"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 NSURLSession的介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建NSURLSession对象的方法"><span class="toc-number">3.2.1.</span> <span class="toc-text">创建NSURLSession对象的方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSURLSessionTask支持的三种任务"><span class="toc-number">3.2.2.</span> <span class="toc-text">NSURLSessionTask支持的三种任务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#NSURLSessionTask类"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">NSURLSessionTask类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NSURLSessionTask相关方法"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">NSURLSessionTask相关方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NSURLSessionConfiguration配置信息"><span class="toc-number">3.2.2.3.</span> <span class="toc-text">NSURLSessionConfiguration配置信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-NSURLSessionDataTask简单GET请求"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.2.1 NSURLSessionDataTask简单GET请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-NSURLSessionDataTask简单POST请求"><span class="toc-number">3.2.4.</span> <span class="toc-text">3.2.2 NSURLSessionDataTask简单POST请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-3-NSURLSessionDataTask的NSURLSessionDataDelegate代理方法"><span class="toc-number">3.2.5.</span> <span class="toc-text">3.2.3 NSURLSessionDataTask的NSURLSessionDataDelegate代理方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-4、NSURLSessionDownloadTask简单下载"><span class="toc-number">3.2.6.</span> <span class="toc-text">3.2.4、NSURLSessionDownloadTask简单下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-5-NSURLSessionDownloadTask的NSURLSessionDownloadDelegate代理方法"><span class="toc-number">3.2.7.</span> <span class="toc-text">3.2.5 NSURLSessionDownloadTask的NSURLSessionDownloadDelegate代理方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-6、NSURLSessionDownloadTask断点下载"><span class="toc-number">3.2.8.</span> <span class="toc-text">3.2.6、NSURLSessionDownloadTask断点下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-7-NSURLSessionUploadTask"><span class="toc-number">3.2.9.</span> <span class="toc-text">3.2.7 NSURLSessionUploadTask</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#四、AFNetworking3-0-使用"><span class="toc-number">4.</span> <span class="toc-text">四、AFNetworking3.0+使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1、AFNetworking的导入"><span class="toc-number">4.1.</span> <span class="toc-text">4.1、AFNetworking的导入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2、简单GET请求"><span class="toc-number">4.2.</span> <span class="toc-text">4.2、简单GET请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3、简单POST请求"><span class="toc-number">4.3.</span> <span class="toc-text">4.3、简单POST请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4、下载"><span class="toc-number">4.4.</span> <span class="toc-text">4.4、下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5、上传"><span class="toc-number">4.5.</span> <span class="toc-text">4.5、上传</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-6、-网络监听"><span class="toc-number">4.6.</span> <span class="toc-text">4.6、 网络监听</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-7、-关于请求、返回格式设置"><span class="toc-number">4.7.</span> <span class="toc-text">4.7、 关于请求、返回格式设置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-1、请求格式（requestSerializer）"><span class="toc-number">4.7.1.</span> <span class="toc-text">4.7.1、请求格式（requestSerializer）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-2、-返回格式"><span class="toc-number">4.7.2.</span> <span class="toc-text">4.7.2、 返回格式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#例"><span class="toc-number">4.8.</span> <span class="toc-text">例</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="univer2012" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/如何搭建个人博客/" title="如何搭建个人博客">如何搭建个人博客<sup>2</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/thinkive/" title="thinkive">thinkive<sup>3</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">Weibo</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=2669931682&verifier=d0f169f2&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello,我是黄胜军(@Univer-V)，一名来自中国深圳的iOS开发者。就职于思迪。 <br/>
			正在通往自由的路上。</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2669931682" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/univer2012" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
		<a href="mailto:1054880335@qq.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2017 
		
		<a href="/about" target="_blank" title="黄胜军">黄胜军</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>




<script type="text/javascript">

var disqus_shortname = 'sengoln';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?62f484087b8a447efc5e7dbbc18aff7d";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
